<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Qué Pasa Bahía Blanca</title>

    <link rel="stylesheet/less" type="text/css" href="/assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap/jquery-ui-1.8.16.custom.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome-ie7.css">
    <link rel="stylesheet/less" type="text/css" href="/assets/css/style.less">

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=geometry&sensor=false"></script>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="/assets/js/jquery-1.8.3.min.js"></script>
    <script type='text/javascript' src='http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js'></script>
    <script src="/assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/less-1.3.1.min.js"></script>

    <!--Templates-->
    <script id="infoWindowTemplateEmpresa" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <h5>${name.value}.</h5> </br>
            <b>Descripci&oacute;n:</b> ${Descripcion.value}.</br>
            <b>Sustancias y productos:</b> ${Sustancias_y_productos.value}. </br></br>
            <b>Contaminantes primarios</b></br>
            <b>&Oacute;xidos de Nitr&oacute;geno NOx (tn/a&ntilde;o):</b> ${NOx.value}.</br>
            <b>Mon&oacute;xido de Carbono CO (tn/a&ntilde;o):</b> ${CO.value}.</br>
            <b>&Oacute;xidos de azufre SOx (tn/a&ntilde;o):</b> ${SOx.value}.</br>
            <b>Material Particulado MP (tn/a&ntilde;o):</b> ${MP.value}.</br></br>
            <a href='${link_referencia.value}'  target="_blank">Link de referencia</a>
        </div>
    </script>
    <script id="infoWindowTemplatePlanta" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <h5>${nombre.value}.</h5> </br>
            <b>Direcci&oacute;n:</b> ${direccion.value}.</br>
            <b>Tel&eacute;fono:</b> ${telefono.value}.</br>
            <b>Fecha de registro:</b> ${dhRegistro.value}. </br>
            <b>Acta:</b>${NombreActa.value}.</br>
        </div>
    </script>
    <script id="infoWindowTemplateDenuncia" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <b>Origen de la denuncia:</b> ${Origen.value}. </br>
            ${Fecha.value} - ${Hora.value}</br>
            <b>Direcci&oacute;n:</b> ${Direccion.value}. </br>
            <b>Detalle de la denuncia:</b></br>
            ${Descripcion.value}</br>
            <b>Informe:</b></br>
            ${Informe.value}

        </div>
    </script>

    <script>
        var mapManager;
        var radiosFT, empresasFT, plantasFT;

        $(window).load(function () {
            // Mapa
            mapManager = new MapManager({
                mapDivId : "map-canvas",
                mapCenter : {lat: -38.7214, lng: -62.258908},
                googleMapsOptions: {
                    zoom : 12,
                    mapTypeId : google.maps.MapTypeId.ROADMAP,
                    styles: [
                        {
                            "elementType": "labels",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        }
                    ]
                }
            });

            // Poligonos de radios censales (Denuncias y Salud)
            radiosFT = new FTClient("1Oc--K4VExbbFppPSm8gG-7GtheahmEPH3ZeKT1I");
            radiosFT.query(["name", "geometry", "SHAPE_AREA"], null, null, function(data) {
                var rows = data.table.rows;

                for (var i=0; i<rows.length; i++) {
                    var row = rows[i];
                    mapManager.addPolygon(row[0], row[1].coordinates[0], row[2]);
                }
                mapManager.setMapType("denuncias");
            });

            // Medidor de aire
            mapManager.addToMarkerLayer("aire", "-38.757221,-62.281698", {
                icon: '/assets/img/meter.png',
                zIndex: 2
            }, {
                radius: 4000,
                zIndex:2,
                fillColor: 'steelblue',
                fillOpacity: 0.3
            });

            // Layer de empresas
            empresasFT = new FTClient("1R1pVgXnt7aCYNK7r2UJVnOrDZ5-vFaJlj8XToZw");
            empresasFT.query(["geometry"], null, null, function(data) {
                var rows = data.table.rows;

                for (var i=0; i<rows.length; i++) {
                    var row = rows[i];
                    mapManager.addToPolygonLayer("empresas", row[0].coordinates[0], {
                        strokeColor: "#000000",
                        strokeOpacity: 0.5,
                        fillColor: "#999999",
                        fillOpacity: 0.8,
                        zIndex: 3
                    });
                }
            });

            // Layers de plantas
            plantasFT = new FTClient("1n-HEILAiMokDtCEaUWAzpGR_QkRP9eihyDLW_f0");
            plantasFT.query(["posicion"], null, null, function(data) {
                var rows = data.table.rows;

                for (var i=0; i<rows.length; i++) {
                    var row = rows[i];
                    mapManager.addToMarkerLayer("plantas", row[0], {
                        icon: '/assets/img/industry.png',
                        zIndex: 4
                    }, null);
                }
            });

            // App
            var qpbb = new Qpbb(mapManager);
            qpbb.init();
        });
    </script>
</head>

<body>

<div class="container">
    <div class="masthead">
        <h2>qpbb <small>¿Qué pasa, Bahía Blanca?</small></h2>
    </div>
    <hr>

    <div>
        <p class="lead" style="font-size: 20px;">Convertimos datos técnicos del municipio en información accesible y la integramos con reportes de vecinos sobre los problemas de la ciudad, el Polo Petroquímico y el Puerto.</p>
        <p>La plataforma está preparada para crecer dinámicamente en un diálogo constante entre los ciudadanos, el municipio y las organizaciones.</p>
    </div>
    <hr/>
    <div class="navigation">
        <ul class="menuItems unstyled">

            <li class="current">
                <a href="#" data-section="denuncias">
                    <div class="section">
                        <h4>Denuncias</h4>
                        <p class="description">Denuncias realizadas al CTE</p>
                    </div>
                    <div class="arrow"></div>
                </a>
            </li>

            <li>
                <a href="#" data-section="salud">
                    <div class="section">
                        <h4>Salud</h4>
                        <p class="description">Consultas de salud</p>
                    </div>
                    <div class="arrow"></div>
                </a>
            </li>

            <li>
                <a href="#" data-section="aire">
                    <div class="section">
                        <h4>Aire</h4>
                        <p class="description">Mediciones de calidad de aire</p>
                    </div>
                    <div class="arrow"></div>
                </a>
            </li>

        </ul>

    </div>
    <div class="row view current" id="map-view">
        <div class="span2">
            <div id="filter">
                <h6>Filtro</h6>
                <ul class="unstyled">
                    <li>
                        <a href="#">
                            <i class="icon-check"></i> Empresas del polo petroquímico
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-check"></i> Plantas del polo petroquímico
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-check"></i> Medidor de Aire
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-check"></i> Agua
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="span10">
            <div id="map-canvas"></div>
        </div>
    </div>
    <div class="row view" id="aqi-view" style="display: none">
        <div class="span12">
            <h2>AQI</h2>
        </div>
    </div>
    <hr/>
</div>



<!--JS Scripts-->
<script type="text/javascript">
    $(function(){
        // Filter
        $('.popoverItem')
                .hover(function(){
                    $(this).popover('show');
                }, function(){
                    $(this).popover('hide');
                })
                .click(function() {
                    if ($(this).find("i").hasClass("icon-check-empty")) {
                        $(this).find("i").removeClass("icon-check-empty").addClass("icon-check");
                        mapManager.showLayer($(this).attr("data-tableKey"));
                    } else {
                        $(this).find("i").removeClass("icon-check").addClass("icon-check-empty");
                        mapManager.hideLayer($(this).attr("data-tableKey"));
                    }
                });
    });
</script>

<script src="/assets/js/MapManager.js"></script>
<script src="/assets/js/FTClient.js"></script>
<script src="/assets/js/qpbb.js"></script>

</body>
</html>