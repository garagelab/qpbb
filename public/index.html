<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Qué Pasa Bahía Blanca</title>

    <link rel="stylesheet/less" type="text/css" href="/assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap/jquery-ui-1.8.16.custom.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/font-awesome-ie7.css">
    <link rel="stylesheet/less" type="text/css" href="/assets/css/style.less">

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="/assets/js/jquery-1.8.3.min.js"></script>
    <script type='text/javascript' src='http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js'></script>
    <script src="/assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/less-1.3.1.min.js"></script>

    <!--Templates-->
    <script id="infoWindowTemplateEmpresa" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <h5>${name.value}.</h5> </br>
            <b>Descripci&oacute;n:</b> ${Descripcion.value}.</br>
            <b>Sustancias y productos:</b> ${Sustancias_y_productos.value}. </br></br>
            <b>Contaminantes primarios</b></br>
            <b>&Oacute;xidos de Nitr&oacute;geno NOx (tn/a&ntilde;o):</b> ${NOx.value}.</br>
            <b>Mon&oacute;xido de Carbono CO (tn/a&ntilde;o):</b> ${CO.value}.</br>
            <b>&Oacute;xidos de azufre SOx (tn/a&ntilde;o):</b> ${SOx.value}.</br>
            <b>Material Particulado MP (tn/a&ntilde;o):</b> ${MP.value}.</br></br>
            <a href='${link_referencia.value}'  target="_blank">Link de referencia</a>
        </div>
    </script>
    <script id="infoWindowTemplatePlanta" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <h5>${nombre.value}.</h5> </br>
            <b>Direcci&oacute;n:</b> ${direccion.value}.</br>
            <b>Tel&eacute;fono:</b> ${telefono.value}.</br>
            <b>Fecha de registro:</b> ${dhRegistro.value}. </br>
            <b>Acta:</b>${NombreActa.value}.</br>
        </div>
    </script>
    <script id="infoWindowTemplateDenuncia" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <b>Origen de la denuncia:</b> ${Origen.value}. </br>
            ${Fecha.value} - ${Hora.value}</br>
            <b>Direcci&oacute;n:</b> ${Direccion.value}. </br>
            <b>Detalle de la denuncia:</b></br>
            ${Descripcion.value}</br>
            <b>Informe:</b></br>
            ${Informe.value}

        </div>
    </script>

    <script>
        var mapManager;
        $(window).load(function () {
            // Mapa
            mapManager = new MapManager({
                mapDivId : "map-canvas",
                mapCenter : {lat: -38.7214, lng: -62.258908},
                googleMapsOptions: {
                    zoom : 12,
                    mapTypeId : google.maps.MapTypeId.ROADMAP
                }
            });

            // Layer de empresas
            mapManager.addFTLayer("empresas", "1R1pVgXnt7aCYNK7r2UJVnOrDZ5-vFaJlj8XToZw", "geometry", "infoWindowTemplateEmpresa", false, {
                styles: [{
                    polygonOptions: {
                        fillColor: "#333333"
                    }
                }]
            });

            // Layers de plantas
            mapManager.addFTLayer("plantas", "1n-HEILAiMokDtCEaUWAzpGR_QkRP9eihyDLW_f0", "posicion", "infoWindowTemplatePlanta", false, {});

            // Layer de denuncias
            mapManager.addFTLayer("denuncias", "1UUkMV28J2E4Z-EwXMdhd9tCKQMicjWNpekYpJBY", "GEO", "infoWindowTemplateDenuncia", true, {});

            // Layer del 0800
            mapManager.addFTLayer("0800", "18HFRQfoJHjyRvd2BeUeK8G4UauJh8pNFgByan5s", "LatLong", null, true, {});

            // Controles
            $("#time-slider").slider({
                range: true,
                min: 1199145600,        // 01/01/2008 UNIX time
                max: 1356912000,        // 31/12/2012 UNIX time
                step: 60 * 60 * 24,     // 1 day
                values: [1199145600, 1356912000],
                slide: function( event, ui ) {
                    var date0 = new Date(ui.values[0] * 1000);
                    var date1 = new Date(ui.values[1] * 1000);

                    $("#date-from").text($.datepicker.formatDate('dd/mm/yy', new Date(ui.values[0] * 1000)));
                    $("#date-to").text($.datepicker.formatDate('dd/mm/yy', new Date(ui.values[1] * 1000)));
                },
                change: function(event, ui) {
                    mapManager.filterMap(new Date(ui.values[0] * 1000), new Date(ui.values[1] * 1000));
                }
            });
            var date0 = new Date($( "#time-slider" ).slider( "values", 0 ) * 1000);
            var date1 = new Date($( "#time-slider" ).slider( "values", 1 ) * 1000);
            $("#date-from").text($.datepicker.formatDate('dd/mm/yy', date0));
            $("#date-to").text($.datepicker.formatDate('dd/mm/yy', date1));
        });
    </script>
</head>

<body>

<div class="container">
    <div class="masthead">
        <h2>qpbb <small>¿Qué pasa, Bahía Blanca?</small></h2>
    </div>
    <hr>

    <div class="">
        <p class="lead" style="font-size: 20px;">Convertimos datos técnicos del municipio en información accesible y la integramos con reportes de vecinos sobre los problemas de la ciudad, el Polo Petroquímico y el Puerto.</p>
        <p>La plataforma está preparada para crecer dinámicamente en un diálogo constante entre los ciudadanos, el municipio y las organizaciones.</p>
    </div>
    <hr/>
    <div class="row">
        <div class="span12">
            <div class="controls">
                <p>Rango de tiempo: <span class="date" id="date-from"></span> - <span class="date" id="date-to"></span></p>
                <div id="time-slider"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="span3">
            <div id="filter" class="well">
                <h6>Filtro</h6>
                <ul class="unstyled">
                    <li>
                        <a href="#" class="popoverItem" rel="popover" data-tableKey="empresas" data-placement="right" data-content="De las 16 empresas que ocupan el Polo, 3 son petroquímicas, 2 son petroleras, 1 es agroquímica, 4 son gasíferas, 1 es eléctrica, y 5 son cerealeras. De las 45 actas de inspección labradas por el CTE en el 2012, el 8 fueron hechas a la Central Piedrabuena S.A., 7 a Solvay Indupa S.A.I.C., y 6 a Petrobrás Argentina S.A." data-original-title="Qué pasa en el polo petroquímico?">
                            <i class="icon-check"></i> Empresas</a>
                    </li>
                    <li>
                        <a href="#" class="popoverItem" rel="popover" data-tableKey="plantas" data-placement="right" data-content="De las 16 empresas que ocupan el Polo, 3 son petroquímicas, 2 son petroleras, 1 es agroquímica, 4 son gasíferas, 1 es eléctrica, y 5 son cerealeras. De las 45 actas de inspección labradas por el CTE en el 2012, el 8 fueron hechas a la Central Piedrabuena S.A., 7 a Solvay Indupa S.A.I.C., y 6 a Petrobrás Argentina S.A." data-original-title="¿Qué pasa con la salud?">
                            <i class="icon-check"></i> Salud</a>
                    </li>
                    <li>
                        <a href="#"><i class="icon-check"></i> Vecinos</a>
                        <ul class="unstyled">
                            <li><a href="#" class="popoverItem" rel="popover" data-tableKey="0800" data-placement="right" data-content="El Sistema de Gestión de Respuesta al Vecino 0800Bahía lleva registradas 36.252 llamadas desde el 1 de enero de 2008. Sirven para obtener respuestas sobre cuestiones de la órbita comunal no vinculadas a las emergencias. La limpieza de un terreno, el alumbrado público y las aguas servidas son los problemas que más se registraron." data-original-title="¿Qué dicen los vecinos?"><i class="icon-check"></i> 0800 Bahía</a></li>
                            <li><a href="#" class="popoverItem" rel="popover" data-tableKey="denuncias" data-placement="right" data-content="Desde el 2008 los vecinos percibieron y reportaron 3695 anomalías ambientales, de los cuales cerca de 1600 se localizan en este mapa." data-original-title="¿Qué dicen los vecinos?"><i class="icon-check"></i> Reclamos al CTE</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" class="popoverItem" rel="popover" data-placement="right" data-content="Los valores de medición del aire son tomados por el único sensor que posee el CTE y que tiene un radio de alcance de 4 km. Desde el año 2009, se registraron 993 hs, equivalente a  41 días, en los cuales los índices de calidad de aire excedieron los niveles admitidos. De ese registro, 789 hs equivalente a 32 días, fue peligroso para grupos en situación de riesgo. Durante 178 hs, equivalente a 7 días, fue insalubre, durante 14 hs muy insalubre, y durante 20 hs, peligroso. Se registraron 975 hs donde el índice de Material Particulado PM10 fue mayor al aceptado por la norma. Se registraron niveles mayores a los admisibles de Monóxido de Carbono durante 10 hs y de Ozono por 8hs." data-original-title="¿Qué pasa en aire?">
                            <i class="icon-check"></i> Aire</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="span9">
            <div id="map-canvas"></div>
        </div>
    </div>
</div>


<!--JS Scripts-->
<script type="text/javascript">
    $(function(){
        // Filter
        $('.popoverItem')
                .hover(function(){
                    $(this).popover('show');
                }, function(){
                    $(this).popover('hide');
                })
                .click(function() {
                    if ($(this).find("i").hasClass("icon-check-empty")) {
                        $(this).find("i").removeClass("icon-check-empty").addClass("icon-check");
                        mapManager.showLayer($(this).attr("data-tableKey"));
                    } else {
                        $(this).find("i").removeClass("icon-check").addClass("icon-check-empty");
                        mapManager.hideLayer($(this).attr("data-tableKey"));
                    }
                });
    });
</script>

<script src="/assets/js/MapManager.js"></script>
<script src="/assets/js/FTClient.js"></script>

</body>
</html>