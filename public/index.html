<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Qué Pasa Bahía Blanca</title>

    <link rel="stylesheet" href="/assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/assets/css/ui-lightness/jquery-ui-1.9.2.custom.min.css">
    <link rel="stylesheet/less" type="text/css" href="/assets/css/style.less">

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="/assets/js/jquery-1.8.3.min.js"></script>
    <script type='text/javascript' src='http://ajax.microsoft.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js'></script>
    <script src="/assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/less-1.3.1.min.js"></script>

    <!--Templates-->
    <script id="infoWindowTemplateEmpresa" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <h5>${name.value}.</h5> </br>
                <b>Descripci&oacute;n:</b> ${Descripcion.value}.</br>
                <b>Sustancias y productos:</b> ${Sustancias_y_productos.value}. </br></br>
                <b>Contaminantes primarios</b></br>
                <b>&Oacute;xidos de Nitr&oacute;geno NOx (tn/a&ntilde;o):</b> ${NOx.value}.</br>
                <b>Mon&oacute;xido de Carbono CO (tn/a&ntilde;o):</b> ${CO.value}.</br>
                <b>&Oacute;xidos de azufre SOx (tn/a&ntilde;o):</b> ${SOx.value}.</br>
                <b>Material Particulado MP (tn/a&ntilde;o):</b> ${MP.value}.</br></br>
                <a href='${link_referencia.value}'  target="_blank">Link de referencia</a>
        </div>
    </script>
    <script id="infoWindowTemplatePlanta" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <h5>${nombre.value}.</h5> </br>
                <b>Direcci&oacute;n:</b> ${direccion.value}.</br>
                <b>Tel&eacute;fono:</b> ${telefono.value}.</br>
                <b>Fecha de registro:</b> ${dhRegistro.value}. </br>
                <b>Acta:</b>${NombreActa.value}.</br>
        </div>
    </script>
    <script id="infoWindowTemplateDenuncia" type="text/x-jquery-tmpl">
        <div class='googft-info-window' style='font-family: sans-serif'>
            <b>Origen de la denuncia:</b> ${Origen.value}. </br>
            ${Fecha.value} - ${Hora.value}</br>
            <b>Direcci&oacute;n:</b> ${Direccion.value}. </br>
            <b>Detalle de la denuncia:</b></br>
            ${Descripcion.value}</br>
            <b>Informe:</b></br>
            ${Informe.value}

        </div>
    </script>

    <script>

        $(window).load(function () {
            // Mapa
            var mapManager = new MapManager({
                mapDivId : "map-canvas",
                mapCenter : {lat: -38.7214, lng: -62.258908},
                googleMapsOptions: {
                    zoom : 12,
                    mapTypeId : google.maps.MapTypeId.ROADMAP
                }
            });

            // Layer de empresas
            mapManager.addFTLayer("empresas", "1R1pVgXnt7aCYNK7r2UJVnOrDZ5-vFaJlj8XToZw", "geometry", "infoWindowTemplateEmpresa", false, {
                styles: [{
                    polygonOptions: {
                        fillColor: "#333333"
                    }
                }]
            });

            // Layers de plantas
            mapManager.addFTLayer("plantas", "1n-HEILAiMokDtCEaUWAzpGR_QkRP9eihyDLW_f0", "posicion", "infoWindowTemplatePlanta", false, {});

            // Layer de denuncias
            mapManager.addFTLayer("denuncias", "1UUkMV28J2E4Z-EwXMdhd9tCKQMicjWNpekYpJBY", "GEO", "infoWindowTemplateDenuncia", true, {});

            // Controles
            $("#time-slider").slider({
                range: true,
                min: 1199145600,        // 01/01/2008 UNIX time
                max: 1356912000,        // 31/12/2012 UNIX time
                step: 60 * 60 * 24,     // 1 day
                values: [1199145600, 1356912000],
                slide: function( event, ui ) {
                    var date0 = new Date(ui.values[0] * 1000);
                    var date1 = new Date(ui.values[1] * 1000);
                    $("#date-from").text($.datepicker.formatDate('dd/mm/yy', new Date(ui.values[0] * 1000)));
                    $("#date-to").text($.datepicker.formatDate('dd/mm/yy', new Date(ui.values[1] * 1000)));
                },
                change: function(event, ui) {
                    mapManager.filterMap(new Date(ui.values[0] * 1000), new Date(ui.values[1] * 1000));
                }
            });
            var date0 = new Date($( "#time-slider" ).slider( "values", 0 ) * 1000);
            var date1 = new Date($( "#time-slider" ).slider( "values", 1 ) * 1000);
            $("#date-from").text($.datepicker.formatDate('dd/mm/yy', date0));
            $("#date-to").text($.datepicker.formatDate('dd/mm/yy', date1));
        });
    </script>
</head>

<body>

<div class="container">
    <div class="row">
        <div class="span3">
            <h6>Filtro</h6>
        </div>
        <div class="span9">
            <div id="controls">
                <p>Rango de tiempo: <span class="date" id="date-from"></span> - <span class="date" id="date-to"></span></p>
                <div id="time-slider"></div>
            </div>
            <div id="map-canvas"></div>
        </div>
    </div>
</div>


<!--JS Scripts-->

<script src="/assets/js/MapManager.js"></script>
<script src="/assets/js/FTClient.js"></script>

</body>
</html>